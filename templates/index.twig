{% extends "_layout" %}

{% set sort = craft.app.request.getParam('sort') ?? 'asc' %}
{% set onlyFuture = craft.app.request.getParam('future') == '1' %}
{% set onlyOpen = craft.app.request.getParam('open') == '1' %}

{% set q = craft.entries().section('reminders') %}

{% if onlyFuture %}
  {% set q = q.datum('>= ' ~ now|date('Y-m-d')) %}
{% endif %}

{% if onlyOpen %}
  {% set q = q.statusSwitch(false) %}
{% endif %}

{% set q = q.orderBy('datum ' ~ (sort == 'desc' ? 'desc' : 'asc')) %}

{% paginate q.limit(10) as pageInfo, reminders %}

{% block content %}
  <div class="flex items-center justify-between gap-4">
    <h1 class="text-2xl font-semibold">Alle Reminders</h1>

    <div class="flex gap-2 text-sm">
      <a class="px-3 py-1 rounded border bg-white hover:bg-slate-50"
         href="/?future={{ onlyFuture ? '0' : '1' }}&open={{ onlyOpen ? '1' : '0' }}&sort={{ sort }}">
        {{ onlyFuture ? 'Alle Daten' : 'Nur zukünftige' }}
      </a>

      <a class="px-3 py-1 rounded border bg-white hover:bg-slate-50"
         href="/?future={{ onlyFuture ? '1' : '0' }}&open={{ onlyOpen ? '0' : '1' }}&sort={{ sort }}">
        {{ onlyOpen ? 'Alle Status' : 'Nur offene' }}
      </a>

      <a class="px-3 py-1 rounded border bg-white hover:bg-slate-50"
         href="/?future={{ onlyFuture ? '1' : '0' }}&open={{ onlyOpen ? '1' : '0' }}&sort={{ sort == 'asc' ? 'desc' : 'asc' }}">
        Sort: {{ sort|upper }}
      </a>
    </div>
  </div>

  <ul class="mt-6 space-y-3">
    {% for entry in reminders %}
      {% set done = entry.statusSwitch ?? false %}
      <li class="rounded-lg border bg-white p-4 flex items-center justify-between">
        <div>
          <a href="{{ entry.url }}" class="font-medium hover:underline">
            {{ entry.title }}
          </a>
          <div class="text-sm text-slate-600">
            {{ entry.datum ? entry.datum|date('d.m.Y') : '' }}
          </div>
        </div>

        <span class="text-xs px-2 py-1 rounded-full {{ done ? 'bg-green-100 text-green-800' : 'bg-amber-100 text-amber-800' }}">
          {{ done ? 'Erledigt' : 'Offen' }}
        </span>
      </li>
    {% endfor %}
  </ul>

  <div class="mt-6 flex items-center justify-between text-sm">
    <div class="text-slate-600">
      Seite {{ pageInfo.currentPage }} von {{ pageInfo.totalPages }}
    </div>

    <div class="flex gap-2">
      {% if pageInfo.prevUrl %}
        <a class="px-3 py-1 rounded border bg-white hover:bg-slate-50" href="{{ pageInfo.prevUrl }}">← Zurück</a>
      {% endif %}
      {% if pageInfo.nextUrl %}
        <a class="px-3 py-1 rounded border bg-white hover:bg-slate-50" href="{{ pageInfo.nextUrl }}">Weiter →</a>
      {% endif %}
    </div>
  </div>
{% endblock %}